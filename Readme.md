# Инструкция для работы с Git и удалёнными репозиторими

## Что такое Git?

***Git*** - это одна из реализаций распределённых систем контроля версий, имеющая как и `локальные`, так и `удалённые` репозитории. Является самой популярной реализацией систем контроля версий в мире.

Для создание репозитория необходимо выполнить команду **git init** в папке с репозиторием и у Вас создаться репозиторий (появится скрытая папка .git)

## Создание коммитов

### Git add

 Для добавления измений в коммит используется команда **git add**. Чтобы использовать команду *git add* напишите ***git add <имя файла>***

## Просмотр состояния репозитория

 Для того, чтобы посмотреть состояние репозитория используется команда **git status**, для этого необходимо в папке с репозиторием написать *git status*, и Вы увидите были ли измения в файлах, или их не было.

## Сохранение коммитов

Для того, чтобы создать коммит(сохранение) необходимо выполнить команду **git commit -m**. При написании комманды `git commet` - Необходимо добавить комментарий к изменению. Выполняется снимок текущего состояния изменений, добавленных в раздел проиндексированных файлов.

 Такие подтвержденные снимки состояния можно рассматривать как "безопасные" версии проекта - Git не будет их менять пока вы не попросите об этом. **Перед выполнением команды *git commit* необходимо использовать комманду *git add*, чтобы проидексировать изменения которые будут сохранены в коммите**.

##

## Что такое удаленный репозиторий?

**Удаленный("внешний") репозиторий** - это версии вашего проекта, сохраненные на удаленном сервере. Доступ к репозиторию на таком сервере может осуществляться по интернету или по локальной сети.

`Удаленный репозиторий` – полноценный репозиторий, ничем не отличающийся от локального. У удаленного репозитория есть собственные ветки, собственный указатель *HEAD*, своя история коммитов и так далее.

Если мы подключим удаленный репозиторий к своему локальному, то у нас появятся копии всех ссылочных объектов удаленного репозитория. То есть, например, у удаленного репозитория есть ветка main, а у нас будет копия этой ветки – **origin/main**. Все такие ссылочные объекты (указатели, ветки и теги) удаленного репозитория хранятся почти там же, где и у локального – в директории `.git/refs/remotes/<имя_удаленного_репозитория>`.

### Настройка подключения удаленного репозитория. Группа команд **git remote**

Необходимость подключить удаленный репозиторий к уже существующему локальному возникает в ситуациях, *когда вы решаете выгрузить уже написанный код на удаленный сервер*. Это нужно, чтобы другие разработчики смогли получить к нему доступ или чтобы вы сами могли заниматься разработкой с нескольких компьютеров (например, домашнего и рабочего).

Для управления подключением удаленных репозиториев в Git предусмотрена целая группа команд – `git remote`. Мы рассмотрим самые частоиспользуемые команды из этой группы.

### Добавление удаленного репозитория к существующему локальному

Давайте разберемся, как добавить удаленный репозиторий к вашему локальному репу. Для этого в Git есть команда **git remote add**.

 `git remote add "название удаленного репозитория" "ссылка на удаленный репозиторий" - Подключает удаленный репозиторий к вашему под переданным именем.`

*Имя удаленного репозитория* в команде *git remote add* вы можете придумать сами. Впоследствии, при работе с этим удаленным репозиторием, вы будете обращаться к нему по придуманному имени. Принято называть удаленный репозиторий origin, но строго говоря, никаких ограничений здесь нет.

Со ссылкой на удаленный репозиторий тоже все просто. Мы работаем с GitHub, поэтому эту ссылку можно взять, нажав на большую зеленую кнопку **Code** на странице репозитория на GitHub.

## HTTPS, SSH и CLI

Начнем с **CLI** - эта ссылка используется в клиенте GitHub, который нужен для упрощения работы с Git. Этот клиент можно поставить отдельно, но его возможности значительно ограничены по сравнению с консольным вариантом Git.

Итак, с последней ссылкой все понятно: ее нужно использовать в специальной программе для компьютера с графическим *UI* от создателей GitHub. Но в чем разница между первыми двумя?

Дело в том, что существует два основных протокола подключения к **git-серверу**: **HTTPS** и **SSH**.

**SSH** считается более надежным, но он немного сложнее в настройке. Давайте разберемся, как настроить подключение для каждого из них.

### Настройка подключения по **HTTPS**

Раньше можно было подключаться по *HTTPS*, используя имя пользователя и пароль от аккаунта GitHub. Но потом эту возможность отключили в целях безопасности. Сейчас вместо пароля нужно использовать персональный токен. Давайте разберемся, как создать такой токен.

Итак, чтобы создать токен персонального доступа, следуйте инструкции:

1. Подтвердите свой **email-адрес**, который вы использовали при регистрации аккаунта GitHub (если он не подтвержден)
2. Кликните на свою аватарку в правом верхнем углу, в открывшемся окне выберите **Settings** (Настройки):
3. Перед вами откроются настройки. В меню слева выберите **Developer settings** (Настройки разработчика)
4. Перед вами откроются Настройки разработчика. В меню слева выберите **Personal access tokens** (токены персонального доступа).
5. Нажмите **Generate new token** (сгенерировать новый токен)
6. Придумайте имя для своего токена. Имя должно описывать, зачем токен был создан.
7. Дайте токену разрешения. Пользователь токена сможет выполнять с удаленным репозиторием только то, что вы указали в этих разрешениях. Чтобы дать токену доступ к управлению удаленным репозиторием из командной строки, выберите **repo**.
8. Нажмите **Generate token** (сгенерировать токен).
9. Скопируйте токен. В целях безопасности, как только вы покинете страницу создания токена, *вы больше не сможете просмотреть этот токен.*

### Настройка подключения по SSH

Чтобы настроить подключение по **SSH**, вам нужно на своем компьютере сгенерировать два **SSH-ключа**: *публичный (public) и секретный (private*).

Как работает **SSH протокол** и зачем ему ключи? Если коротко, то публичный ключ передается на удаленный сервер, а секретный все время остается с вами. Удаленный сервер использует публичный ключ, чтобы удостовериться, что у вас действительно есть секретный ключ. Как только сервер убеждается в наличии у вас секретного ключа, он понимает, что вы – это вы, ведь секретный ключ нельзя подделать.

После создания пары ключей, надо добавить секретный ключ в **SSH-агента**.

**SSH-агент** – это специальная программа, которая сохраняет пароль от файла с секретным ключом и помогает удаленному серверу удостовериться, что вы действительно владеете секретным ключом. Благодаря **SSH-агенту**, вам не потребуется при каждом подключении к удаленному серверу вводить пароль от файла с приватным ключом.

После останется только загрузить наш публичный ключ на GitHub и готово. Давайте рассмотрим этот процесс подробнее:

1. Откройте **Git Bash** (или терминал, если вы работаете на *Linux/MacOS*)
2. Выполните в нем команду **ssh-keygen -t rsa 4096 -C "<ваша-почта>@example.com"**
 Вам предложат ввести путь к директории, в которой будет сохранен ключ, а также будет выведена директория для сохранения по умолчанию. Нажмите *Enter*, чтобы выбрать директорию по умолчанию, либо введите любую другую директорию и тоже нажмите *Enter*.
 Затем вам предложат ввести пароль для файла с секретным ключом. Нажмите *Enter*, чтобы оставить файл без пароля, либо введите пароль и нажмите *Enter*.
3. Теперь нужно добавить ключ в **SSH-агента**. Запустим агента командой `eval ssh-agent -s`
4. Теперь выполните команду `ssh-add <путь до приватного ключа>`. Если вы оставили путь по умолчанию, ваша команда будет выглядеть так: **ssh-add ~/.ssh/id_ed25519**
5. Отлично, последний этап: добавляем публичный ключ на **GitHub**. Для этого откройте файл с публичным ключом (он должен иметь расширение .pub). Если вы оставили путь по умолчанию, то ваш ключ будет располагаться по адресу `~/.ssh/id_ed25519.pub.`
6. Скопируйте содержимое файла.
7. Перейдите в настройки GitHub
8. Откройте раздел `SSH and GPG keys (ssh и gpg ключи)`
9. Нажмите `New SSH key` (новый ssh-ключ)
10. В поле **Title** (заголовок) введите содержательное название ключа, например **ключ для ноутбука** или **ключ рабочего компьютера**
11. Скопированный ключ вставьте в раздел **Key** (ключ)
12. Нажмите **Add SSH key** (добавить ssh-ключ)
13. Возможно потребуется ввести пароль для подтверждения действия.

Теперь SSH-ключ добавлен. Вам больше не нужно вводить имя пользователя и пароль при каждой загрузке или скачивании изменений из удаленного репозитория

### Отключение удаленного репозитория от локального

Иногда возникает необходимость **забыть** удаленный репозиторий. Для этого существует команда `git remote remove.`

### Изменение имени удаленного репозитория. Просмотр всех удаленных репозиториев

Иногда возникает необходимость переименовать удаленный репозиторий. Для этого существует команда `git remote rename "старое имя удаленного репозитория" "новое имя удаленного репозитория"`

Еще более частая задача – просмотреть список всех подключенных удаленных репозиториев и получить информацию о каждом из них. Для этого существует команда `git remote show`

`git clone "ссылка на удаленный репозиторий" - клонирование удаленного репозитория`

Заметьте, что клонирование по **https** возможно вообще всегда, а по **ssh** – нет. Чтобы клонировать репозитории по **ssh**, нужно, чтобы владелец удаленного репозитория на *GitHub* добавил к себе публичный **ssh-ключ** из пары, в то время, как секретный **ssh-ключ** от той же пары хранится у вас на компьютере, с которого вы выполняете ***git clone***. Таким образом, если вы настроили **ssh** в своем аккаунте, то вы сможете беспрепятственно клонировать свои репозитории и по **https**, и по **ssh**. Но если вы пытаетесь клонировать чужой репозиторий по **ssh**, то скорее всего получите ошибку доступа.

`Окончательный выбор протокола для клонирования, конечно, остается за читателем. Работать по https проще и быстрее, зато он считается менее защищенным, чем ssh, который в свою очередь труднее в настройке.`

### Получение изменений из удаленного репозитория

`git fetch "ключи" "имя удаленного репозитория"` - получить изменения из удаленного репозитория

Важным замечанием здесь станет то, что команда не обновляет рабочую копию в соответствии с удаленным репозиторием. Она обновляет только ссылочные объекты (указатели, ветки и теги) и скачивает все необходимые файлы в директорию **.git/objects.**

`git merge "ветка 1"/"ветка 2" - обьединение двух веток в одну.`

Кстати, в выводе команды **git merge** можно заметить, что слияние прошло в *fast-forward* режиме. Именно поэтому не было создано merge-коммита. На самом деле, слияние удаленной ветки очень часто можно выполнить в *fast-forward* режиме, но иногда все-таки приходится разрешать конфликты и создавать *merge-коммиты.*

Команда **git fetch** используется для синхронизации локальных ссылочных объектов с этими же объектами в удаленном репозитории. Рабочую копию она не меняет.
Чтобы синхронизировать локальную рабочую копию с удаленным репозиторием, нужно слить удаленные ветки в локальные. Сделать это можно уже знакомой командой **git merge.**

Связкой **git fetch && git merge** мы получили изменения из удаленного репозитория и обновили свою рабочую копию. Часто вместо этого хочется получать изменения и сразу обновлять рабочую копию так, чтобы она соответствовала удаленному репозиторию. И для этого в *Git* существует отдельная команда. Называется она **git pull**.

`git pull "ключи" "имя удаленного репозитория"` Получает изменения из переданного удаленного репозитория и обновляет рабочую копию в соответствии с удаленным репозиторием. По умолчанию слияние удаленной ветки с локальной происходит именно в fast-forward режиме, так что включать его специально не требуется

**Ключи:**

* --ff
* --no-ff
* --ff-only

Эти ключи определяют стратегию слияния. **--ff** – включить fast-forward, если это возможно, **--no-ff** – отключить fast-forward, а **--ff-only** – остановить pull, если его невозможно сделать в fast-forward.

Команда **git pull** это просто сокращение последовательного применения **git fetch и git merge**. Но используется **git pull** намного чаще.